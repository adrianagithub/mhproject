<p id="notice"><%= notice %></p>

<div class="col-12 mr-auto">
  <div id="no-more-tables" class="table-responsive card mb-5"> 
    <div class="text-center card mb-5">
      <table class="table table-hover" id="therapists">
        <h1>Therapists</h1>
        <thead class=“cf”>
          <div class=“row”>
            <tr>
              <strong><th class=“h2” style=“background:none;“>First name</th></strong>
              <strong><th class=“h2” style=“background:none;“>Last name</th></strong>
              <strong><th class=“h2” style=“background:none;“>Kind</th></strong>
              <strong><th class=“h2” style=“background:none;“>Category</th></strong>
              <strong><th class=“h2” style=“background:none;“>Phone number</th></strong>
              <strong><th class=“h2” style=“background:none;“>Url</th></strong>
              <strong><th class=“h2” style=“background:none;“>Picture</th></strong>
              <strong><th colspan="3"></th>              
            </tr>
          </div>
        </thead>
        <tbody>
          <% @therapists.each do |therapist| %>
          <div class="row">
          <tr>
            <td><%= therapist.first_name %></td>
            <td><%= therapist.last_name %></td>
            <td><%= therapist.kind %></td>
            <td><%= therapist.category.name%></td>
            <td><%= therapist.phone_number %></td>
            <td><%= therapist.url %></td>
            <td><%= therapist.picture %></td>
            <td><%= link_to 'Show', therapist %></td>
            <td><%= link_to 'Edit', edit_therapist_path(therapist) %></td>
            <td><%= link_to 'Destroy', therapist, method: :delete, data: { confirm: 'Are you sure?' } %></td>
          </tr>
          </div>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>


<div class="col-12 mr-auto">
  <div id="no-more-tables" class="table-responsive card mb-5"> 
    <div class="text-center card mb-5">
      <table class="table table-hover" id="report">
        <thead class=“cf”>
          <div class=“row”>
            <tr>
              <strong><th class=“h2” style=“background:none;“>Therapist category</th></strong>
              <th class=“h2” style=“background:none;“>Total</th>
            </tr>
          </div>
        </thead>
        <tbody>
          <% @count_therapist.each do |id, count| %> 
            <div class="row"> 
            <tr>      
              <td><%= Category.find(id).name%></td> 
              <td><%= p count%></td>
            </tr>
            </div>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<div >
<div class=“row”>
<div class="actions center">
  <%= link_to 'New Therapist', new_therapist_path, :class => 'btn btn-sm text-uppercase font-weight-bold mb-2' %>
<br>
  <button class="btn btn-sm text-uppercase font-weight-bold mb-2" onclick="exportData()">
    <%# <span class="glyphicon glyphicon-download mr-2"></span> %>
    Export Report
  </button>     
</div>
</div>
<script>
function exportData(tableID, filename = ''){
    var downloadLink;
    var dataType = 'application/vnd.ms-excel';
    var tableSelect = document.getElementById("therapists");
    var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');
    
    // Specify file name
    filename = filename?filename+'.xls':'excel_data.xls';
    
    // Create download link element
    downloadLink = document.createElement("a");
    
    document.body.appendChild(downloadLink);
    
    if(navigator.msSaveOrOpenBlob){
        var blob = new Blob(['\ufeff', tableHTML], {
            type: dataType
        });
        navigator.msSaveOrOpenBlob( blob, filename);
    }else{
        // Create a link to the file
        downloadLink.href = 'data:' + dataType + ', ' + tableHTML;
    
        // Setting the file name
        downloadLink.download = filename;
        
        //triggering the function
        downloadLink.click();
    }
}
</script>